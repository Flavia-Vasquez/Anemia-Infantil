<!doctype html>
<!--[if gt IE 9]><!--> <html lang="en" class="no-focus"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">

        <title>UNALM</title>

        <meta name="description" content="Codebase - Bootstrap 4 Admin Template &amp; UI Framework created by pixelcave and published on Themeforest">
        <meta name="author" content="pixelcave">
        <meta name="robots" content="noindex, nofollow">
        <meta property="og:title" content="Codebase - Bootstrap 4 Admin Template &amp; UI Framework">
        <meta property="og:site_name" content="Codebase">
        <meta property="og:description" content="Codebase - Bootstrap 4 Admin Template &amp; UI Framework created by pixelcave and published on Themeforest">
        <meta property="og:type" content="website">
        <meta property="og:url" content="">
        <meta property="og:image" content="">
        <link rel="shortcut icon" href="../static/img/favicons/favicon.png">
        <link rel="icon" type="image/png" sizes="192x192" href="../static/img/favicons/favicon-192x192.png">
        <link rel="apple-touch-icon" sizes="180x180" href="../static/img/favicons/apple-touch-icon-180x180.png">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
        <link rel="stylesheet" id="css-main" href="../static/css/codebase.min.css">
    </head>
    
    <body>
        <!-- Page Container -->
        <div id="page-container" class="page-header-modern main-content-boxed side-trans-enabled sidebar-inverse">
            <!-- Header -->
            <header id="page-header">
                <!-- Header Content -->
                <div class="content-header">
                    <div class="d-flex">
                        <div class="dropdown d-inline-block mr-2">
                            <button type="button" class="btn btn-outline-primary dropdown-toggle" id="dropdown-department" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Seleccione Departamento
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdown-department">
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Amazonas')">Amazonas</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Áncash')">Áncash</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Apurímac')">Apurímac</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Arequipa')">Arequipa</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Ayacucho')">Ayacucho</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Cajamarca')">Cajamarca</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Callao')">Callao</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Cusco')">Cusco</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Huancavelica')">Huancavelica</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Huánuco')">Huánuco</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Ica')">Ica</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Junín')">Junín</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('La Libertad')">La Libertad</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Lambayeque')">Lambayeque</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Lima')">Lima</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Loreto')">Loreto</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Madre de Dios')">Madre de Dios</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Moquegua')">Moquegua</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Pasco')">Pasco</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Piura')">Piura</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Puno')">Puno</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('San Martín')">San Martín</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Tacna')">Tacna</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Tumbes')">Tumbes</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Ucayali')">Ucayali</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Lima Metropolitana 1')">Lima Metropolitana 1</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectDepartment('Lima 2')">Lima 2</a>
                            </div>
                        </div>
                
                        <div class="dropdown d-inline-block mr-2">
                            <button type="button" class="btn btn-outline-primary dropdown-toggle" id="dropdown-year" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Seleccione Año
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdown-year">
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2008)">2008</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2009)">2009</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2010)">2010</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2011)">2011</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2012)">2012</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2013)">2013</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2014)">2014</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2015)">2015</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2016)">2016</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2017)">2017</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2018)">2018</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2019)">2019</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2020)">2020</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2021)">2021</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2022)">2022</a>
                                <a class="dropdown-item" href="javascript:void(0)" onclick="selectYear(2023)">2023</a>
                            </div>
                        </div>
                
                        <button type="submit" class="btn btn-primary" data-toggle="click-ripple">Filtrar</button>
                    </div>
                </div>
                <!-- END Header Content -->

                <!-- Header Loader -->
                <!-- Please check out the Activity page under Elements category to see examples of showing/hiding it -->
                <div id="page-header-loader" class="overlay-header bg-primary">
                    <div class="content-header content-header-fullrow text-center">
                        <div class="content-header-item">
                            <i class="fa fa-sun-o fa-spin text-white"></i>
                        </div>
                    </div>
                </div>
                <!-- END Header Loader -->
            </header>
            <!-- END Header -->

            <!-- Main Container -->
            <main id="main-container">
                <!-- Page Content -->
                <div class="content">
                    <div class="row gutters-tiny invisible" data-toggle="appear">
                        <!-- Row #1 -->
                            <!-- Bloque vacío 1 -->

                            <!-- Bloque vacío 2 -->

                            <!-- Bloque vacío 3 -->
                            
                            <!-- Bloque vacío 4 -->

                        <!-- END Row #1 -->
                    </div>
                    <div class="row gutters-tiny invisible" data-toggle="appear">
                        <!-- Row #2 -->
                        <!-- Bloque vacío 1 (para gráfico de análisis) -->
                        <div class="col-md-6">
                            <div class="block">
                                <div class="block-header bg-primary">
                                    <div class="block-options">
                                        <h2 class="block-title text-white">
                                            Gráfico de Proporciones 
                                        </h2>
                                        <button type="button" class="btn-block-option text-white" data-toggle="block-option" data-action="content_toggle"></button>
                                    </div>
                                </div>
                                <div class="block-content block-content-full">
                                    <div id="chart-container" style="margin-top: -10px; width: 100%; height: 400px; overflow: hidden;">
                                        <!-- Aquí se mostrará el gráfico generado -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bloque vacío 2 (para otro gráfico de análisis) -->
                        <div class="col-md-6">
                            <div class="block">
                                <div class="block-header bg-primary">
                                    <h3 class="block-title text-white">
                                        Interpretación 
                                    </h3>                                    
                                    <div class="block-options">
                                        <button type="button" class="btn-block-option text-white" data-toggle="block-option" data-action="content_toggle"></button>
                                    </div>
                                </div>
                                <div class="block-content block-content-full">
                                    <!-- Contenedor para mostrar la interpretación -->
                                    <div id="interpretation-container-2" style="margin-top: 18px;">
                                        <!-- Aquí se mostrará la interpretación -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END Page Content -->
            </main>
            <!-- END Main Container -->

            <!-- Footer -->
            <footer id="page-footer" class="opacity-0">
                <div class="content py-20 font-size-xs clearfix">
                    <div class="float-right">
                        Estadística e Informática  
                    </div>
                    <div class="float-left">
                        <span class="js-year-copy">UNALM</span>
                    </div>
                </div>
            </footer>
            <!-- END Footer -->
        </div>
        <!-- END Page Container -->

        <!-- Codebase Core JS -->
        <script src="../static/js/core/jquery.min.js"></script>
        <script src="../static/js/core/popper.min.js"></script>
        <script src="../static/js/core/bootstrap.min.js"></script>
        <script src="../static/js/core/jquery.slimscroll.min.js"></script>
        <script src="../static/js/core/jquery.scrollLock.min.js"></script>
        <script src="../static/js/core/jquery.appear.min.js"></script>
        <script src="../static/js/core/jquery.countTo.min.js"></script>
        <script src="../static/js/core/js.cookie.min.js"></script>
        <script src="../static/js/codebase.js"></script>

        <!-- Page JS Plugins -->
        <script src="../static/js/plugins/chartjs/Chart.bundle.min.js"></script>

        <!-- Page JS Code -->
        <script src="../static/js/pages/be_pages_dashboard.js"></script>

        <!-- Custom Script -->
        <script>
            let selectedDepartment = "";
            let selectedYear = "";

            function selectDepartment(department) {
                selectedDepartment = department;
                document.getElementById('dropdown-department').innerText = department;
            }

            function selectYear(year) {
                selectedYear = year;
                document.getElementById('dropdown-year').innerText = year;
            }

            document.addEventListener('DOMContentLoaded', () => {
                document.querySelector('button[type="submit"]').addEventListener('click', () => {
                    // Validar que el usuario haya seleccionado ambos filtros
                    if (!selectedDepartment || !selectedYear) {
                        alert('Por favor, selecciona un departamento y un año.');
                        return;
                    }

                    // Actualizar el encabezado con el año y el departamento seleccionados

                    // Limpia los contenedores de gráficos antes de cargar nuevos
                    document.getElementById('chart-container').innerHTML = 'Cargando gráfico de pastel...';
                    document.getElementById('interpretation-container-2').innerHTML = 'Cargando interpretación...';

                    // Cargar el primer gráfico (barras)
                    fetch('/generate-chart', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ year: selectedYear, department: selectedDepartment })
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Mostrar el gráfico de barras
                        if (data.image_url) {
                            document.getElementById('chart-container').innerHTML = `<img src="${data.image_url}" alt="Gráfico de barras" style="width: 100%; height: auto;">`;
                        } else if (data.error) {
                            document.getElementById('chart-container').innerText = `Error: ${data.error}`;
                        }

                        // Mostrar la interpretación
                        if (data.interpretation) {
                            document.getElementById('interpretation-container-2').innerHTML = `<pre>${data.interpretation}</pre>`;
                        }
                    })
                    .catch(err => {
                        document.getElementById('chart-container').innerText = `Error al cargar el gráfico de barras: ${err}`;
                    });
                });
            });
        </script>
             
    </body>
</html>